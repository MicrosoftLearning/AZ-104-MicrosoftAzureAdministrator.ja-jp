---
lab:
    title: '10 - データ保護を実装する'
    module: 'モジュール 10 - データ保護'
---

# ラボ 10 - データ保護を実装する
# 受講生用ラボ マニュアル

## ラボ シナリオ

Azure 仮想マシンとオンプレミス コンピューターでホストされているファイルのバックアップと復元に Azure Recovery Services の使用を検討します。また、Recovery Services コンテナーに格納されているデータを、不慮または悪意のあるデータ損失から保護する方法を確認したいと思っています。

## 目標

このラボでは次の内容を学習します。

+ タスク 1: ラボ環境をプロビジョニングする
+ タスク 2: Recovery Services コンテナーを作成する
+ タスク 3: Azure 仮想マシン レベルのバックアップを実装する
+ タスク 4: ファイルとフォルダーのバックアップを実装する
+ タスク 5: Azure Recovery Services エージェントを使用してファイルの回復を行う
+ タスク 6: Azure 仮想マシンのスナップショット (オプション) を使用してファイルの回復を実行する
+ タスク 7: Azure Recovery Services の論理的な削除機能 (オプション) を確認する

## 予想時間: 50 分

## 手順

### 演習 1

#### タスク 1: ラボ環境をプロビジョニングする

このタスクでは、異なるバックアップ シナリオをテストするために使用する 2 つの仮想マシンをデプロイします。

1. [Azure portal](https://portal.azure.com) にサインインします。

1. Azure portal の右上にあるアイコンをクリックして **Azure Cloud Shell** を開きます。

1. **Bash** や **PowerShell** のどちらかを選択するためのプロンプトが表示されたら、**PowerShell** を選択します。

    > **注**: **Cloud Shell** の初回起動時に 「**ストレージがマウントされていません**」 というメッセージが表示された場合は、このラボで使用しているサブスクリプションを選択し、「**ストレージの作成**」 を選択します。

1. Cloud Shell ウィンドウのツールバーで、「**ファイルのアップロード/ダウンロード**」 アイコンをクリックし、ドロップダウン メニューで 「**アップロード**」 をクリックして、ファイル **\\Allfiles\\Labs\\10\\az104-10-vms-edge-template.json** と **\\Allfiles\\Labs\\10\\az104-10-vms-edge-parameters.json** を Cloud Shell ホーム ディレクトリにアップロードします。

1. Cloud Shell ウィンドウから次のコマンドを実行して、仮想マシンをホストするリソース グループを作成します (`[Azure_region]` プレースホルダーを、Azure 仮想マシンをデプロイする Azure リージョンの名前に置き換えます)。各コマンドラインを個別に入力し、個別に実行します。

   ```powershell
   $location = '[Azure_region]'
    ```
   ```powershell
   $rgName = 'az104-10-rg0'
    ```
   ```powershell
   New-AzResourceGroup -Name $rgName -Location $location
   ```

1. 「Cloud Shell」ウィンドウで、次のコマンドを実行して最初の仮想ネットワークを作成し、アップロードしたテンプレートとパラメーター ファイルを使用して仮想マシンをデプロイします。

   ```powershell
   New-AzResourceGroupDeployment `
      -ResourceGroupName $rgName `
      -TemplateFile $HOME/az104-10-vms-edge-template.json `
      -TemplateParameterFile $HOME/az104-10-vms-edge-parameters.json `
      -AsJob
   ```

1. Cloud Shell を最小化します (ただし、閉じないでください)。

    > **注**: デプロイが完了するのを待たずに、代わりに次のタスクに進みます。デプロイメント過程は約 5 分間かかる場合があります。

#### タスク 2: Recovery Services コンテナーを作成する

このタスクでは、Recovery Services コンテナーを作成します。

1. Azure portal で、「**Recovery Services コンテナー**」 を検索して選択し、「**Recovery Services コンテナー**」 ブレードで 「**+ 作成**」 をクリックします。

1. 「**Recovery Services コンテナーの作成**」 ブレードで、次の設定を指定します。

    | 設定 | 値 |
    | --- | --- |
    | 定期売買 | このラボで使用する Azure サブスクリプションの名前 |
    | リソース グループ | 新しいリソース グループ **az104-10-rg1** の名前 |
    | コンテナー名 | **az104-10-rsv1** |
    | リージョン | 前のタスクで 2 つの仮想マシンをデプロイしたリージョンの名前 |

    >**注**: 前のタスクで仮想マシンをデプロイしたリージョンと同じリージョンを指定してください。

1. 「**確認および作成**」 をクリックし、検証が成功したことを確認して、「**作成**」 をクリックします。

    >**注**: デプロイが完了するのを待ちます。デプロイにかかる時間は 1 分未満です。

1. デプロイが完了したら、「**リソースに移動**」 をクリックします。

1. 「**az104-10-rsv1** Recovery Services コンテナー」 ブレードの 「**設定**」 セクションで、「**プロパティ**」 をクリックします。

1. 「**az104-10-rsv1 - プロパティ**」 ブレードで、「**バックアップ構成**」 ラベルの下の 「**更新**」 リンクをクリックします。

1. 「**バックアップ構成**」 ブレードで、「**ストレージ レプリケーションの種類**」 を 「**ローカル冗長**」 または 「**geo 冗長**」 のいずれかに設定できます。「**geo 冗長**」 のデフォルト設定をそのままにして、ブレードを閉じます。

    >**注**: この設定は、既存のバックアップ アイテムがない場合にのみ構成できます。

1. 「**az104-10-rsv1 - プロパティ**」 ブレードに戻り、「**セキュリティ設定**」 ラベルの下にある 「**更新**」 リンクをクリックします。

1. 「**セキュリティ設定**」 ブレードで、「**論理的な削除 (Azure 仮想マシンの場合)**」 が 「**有効**」 であることを確認します。

1. 「**セキュリティ設定**」 ブレードを閉じ、「**az104-10-rsv1** Recovery Services コンテナー」 ブレードに戻り、「**概要**」 をクリックします。

#### タスク 3: Azure 仮想マシン レベルのバックアップを実装する

このタスクでは、Azure 仮想マシン レベルのバックアップを実装します。

   >**注**: このタスクを開始する前に、このラボの最初のタスクで開始したデプロイが正常に完了したことを確認します。

1. 「**az104-10-rsv1** Recovery Services コンテナー」 ブレードで、「**概要**」 をクリックしてから、「**+ バックアップ**」.をクリックします。

1. 「**バックアップの目標**」 ブレードで、次の設定を指定します。

    | 設定 | 値 |
    | --- | --- |
    | ワークロードの実行場所。 | **Azure** |
    | バックアップの対象。 | **仮想マシン** |

1. 「**バックアップの目標**」 ブレードで 「**バックアップ**」 をクリックします。

1. 「**バックアップ ポリシー**」 で、「**DefaultPolicy**」 の設定を確認し、「**新しいポリシーの作成**」 を選択します。

1. 次の設定を使用して新しいバックアップ ポリシーを定義します (他の設定は既定値のままにします)。

    | 設定 | 値 |
    | ---- | ---- |
    | ポリシー名 | **az104-10-backup-policy** |
    | 頻度 | **毎日** |
    | 時刻 | **0:00** |
    | タイムゾーン | ローカル タイム ゾーンの名前 |
    | のインスタント回復スナップショットを保持 | **2** 日間 |

1. 「**OK**」 をクリックしてポリシーを作成し、「**仮想マシン**」 セクションで 「**追加**」 を選択します。

1. 「**仮想マシンの選択**」 ブレードで、「**az-104-10-vm0**」 を選択し、「**OK**」 をクリックして、「**バックアップ**」 ブレードで、「**バックアップを有効にする**」 をクリックします。

    >**注**: バックアップが有効になるまで待ちます。これにはおよそ 2 分かかります。

1. **az104-10-rsv1** の 「Recovery Services コンテナー」 ブレードに戻り、「**保護されたアイテム**」 セクションで 「**バックアップ アイテム**」 をクリックしてから、「**Azure 仮想マシン**」 エントリをクリックします。

1. **az104-10-vm0** の 「**バックアップ アイテム (Azure 仮想マシン)**」 ブレードで、「**バックアップ事前チェック**」、および 「**最後のバックアップの状態**」 エントリの値を確認し、「az104-10-vm0」 エントリをクリックします。

1. **az104-10-vm0** の 「バックアップ アイテム」 ブレードで、「**今すぐバックアップ**」 をクリックし、「**バックアップの保持期間**」 ドロップダウン リストで既定値をそのまま使用して、「**OK**」 をクリックします。

    >**注**: バックアップが完了するのを待たずに、次のタスクに進みます。

#### タスク 4: ファイルとフォルダーのバックアップを実装する

このタスクでは、Azure Recovery Services を使用してファイルとフォルダーのバックアップを実装します。

1. Azure portalで、「**仮想マシン**」 を検索して選択し、「**仮想マシン**」 ブレードで、「**az104-10-vm1**」 を選択します 。

1. 「**az104-10-vm1**」 ブレードで、「**接続**」 をクリックし、ドロップダウン メニューで 「**RDP**」 をクリックし、「**RDP を使用して接続する**」 ブレードで 「**RDP ファイルのダウンロード**」 をクリックし、プロンプトに従ってリモート デスクトップ セッションを開始します。

    >**注**: この手順では、Windows コンピューターからリモート デスクトップ経由で接続することを指します。Mac では、Mac App Store からリモート デスクトップ クライアントを使用でき、Linux コンピューターでは、オープンソースの RDP クライアント ソフトウェアを使用できます。

    >**注**: ターゲット仮想マシンに接続する際は、警告メッセージを無視できます。

1. プロンプトが表示されたら、**Student**のユーザー名と **Pa55w.rd1234** パスワードを使用してサインインします。

    >**注:** Azure portal では IE 11 をサポートしなくなっているため、このタスクには Microsoft Edge ブラウザーを利用する必要があります。

1. **az104-10-vm1** Azure 仮想マシンへのリモート デスクトップ セッション内で、Edge Web ブラザーを起動し、[Azure portal](https://portal.azure.com) を参照して、資格情報を使用してサインインします。

1. Azure portal で、「**Recovery Services コンテナー**」 を検索して選択し、「**Recovery Services コンテナー**」 ブレードで、「**az104-10-rsv1**」 をクリックします。

1. **az104-10-rsv1** の 「Recovery Services コンテナー」 ブレードで、「**+ バックアップ**」 をクリックします。

1. 「**バックアップの目標**」 ブレードで、次の設定を指定します。

    | 設定 | 値 |
    | --- | --- |
    | ワークロードの実行場所。 | **オンプレミス** |
    | バックアップの対象。 | **ファイルとフォルダー** |

    >**注**: このタスクで使用している仮想マシンは Azure で実行されていますが、この仮想マシンを利用して、Windows Server オペレーティング システムを実行しているオンプレミス コンピューターに適用可能なバックアップ機能を評価できます。

1. 「**バックアップの目標**」 ブレードで、「**インフラストラクチャの準備**」 をクリックします。

1. 「**インフラストラクチャの準備**」 ブレードで、「**Windows サーバーまたは Windows クライアント用のエージェントのダウンロード**」 リンクをクリックします。

1. プロンプトが表示されたら、「**実行**」 をクリックして、既定の設定で **MARSAgentInstaller.exe** のインストールを開始します。

    >**注**: **Microsoft Azure Recovery Services エージェント セットアップ ウィザード**の 「**Microsoft Update のオプトイン**」 ページで、「**Microsoft Update のインストール オプションを使用しない**」 を選択します。

1. **Microsoft Azure Recovery Services エージェント セットアップ ウィザード**の 「**インストール**」 ページで、「**登録に進む**」 をクリックします。これにより、**サーバーの登録ウィザード**が起動します。

1. Azure portal を表示している Web ブラザー ウィンドウに切り替え、「**インフラストラクチャの準備**」 ブレードで、「**既にダウンロード済み、または最新の回復サーバー エージェントを使用**」 チェックボックスを選択し、「**ダウンロード**」 をクリックします。

1. コンテナーの資格情報ファイルを開くか保存するかを確認するメッセージが表示されたら、「**保存**」 をクリックします。これにより、コンテナーの認証情報ファイルがローカルのダウンロード フォルダーに保存されます。

1. 「**サーバーの登録ウィザード**」 ウィンドウに戻り、「**コンテナー ID**」 ページで、「**参照**」 をクリックします。

1. 「**コンテナー認証情報の選択**」 ダイアログ ボックスで、「**ダウンロード**」 フォルダーを参照し、ダウンロードしたコンテナー認証情報ファイルをクリックして、「**開く**」 をクリックします。

1. 「**コンテナー ID**」 ページに戻り、「**次へ**」 をクリックします。

1. 「**サーバー登録ウィザード**」 の 「**暗号化の設定**」 ページで、「**パスフレーズの生成**」 をクリックします。

1. 「**サーバーの登録ウィザード**」 の 「**暗号化設定**」 ページで、「**パスフレーズを保存する場所を入力してください**」 ドロップダウン リストの横にある、「**参照**」 ボタンをクリックします。

1. 「**フォルダーの参照**」 ダイアログ ボックスで、「**ドキュメント**」 フォルダーを選択し、「**OK**」 をクリックします。

1. 「**完了**」 をクリックし、**Microsoft Azure Backup** の警告を確認して 「**はい**」 をクリックし、登録が完了するまで待ちます。

    >**注**: 運用環境では、バックアップするサーバー以外の安全な場所にパスフレーズ ファイルを保存する必要があります。

1. 「**サーバーの登録ウィザード**」 の 「**サーバー登録**」 ページで、パスフレーズ ファイルの場所に関する警告を確認し、「**Microsoft Azure Recovery Services エージェントの起動**」 チェックボックスがオンになっていることを確認し、「**閉じる**」 をクリックします。これにより、自動的に **Microsoft Azure Backup** コンソールが開きます。

1. **Microsoft Azure Backup** コンソールの 「**操作**」 ウィンドウで、「**バックアップのスケジュール**」 をクリックします。

1. 「**バックアップのスケジュール ウィザード**」 の 「**はじめに**」 ページで、「**次へ**」 をクリックします。

1. 「**バックアップするアイテムの選択**」 ページで、「**アイテムの追加**」 をクリックします。

1. 「**アイテムの選択**」 ダイアログ ボックスで、**C:\\Windows\\System32\\drivers\\etc\\** を展開し、「**ホスト**」 を選択して 「**OK**」 をクリックします。

1. 「**バックアップするアイテムの選択**」 ページで、「**次へ**」 をクリックします。

1. 「**バックアップ スケジュールの選択**」 ページで、「**日**」 オプションが選択されていることを確認し、「**次の時刻 (最大許容時間は 1 日 3 回)**」 ボックスの下にある最初のドロップダウン リスト ボックスで 「**4:30 AM**」 を選択し、「**次へ**」 をクリックします。

1. 「**保持ポリシーの選択**」 ページで、既定の設定値を受け入れてから、「**次へ**」 をクリックします。

1. 「**初期バックアップの種類の選択**」 ページで、既定の設定値を受け入れてから、「**次へ**」 をクリックします。

1. 「**確認**」 ページで、「**完了**」 をクリックします。バックアップ スケジュールが作成されたら、「**閉じる**」 をクリックします。

1. **Microsoft Azure Backup** コンソールの 「操作」 ウィンドウで、「**今すぐバックアップ**」 をクリックします。

    >**注**: スケジュール バックアップを作成すると、オンデマンドでバックアップを実行するオプションが使用可能になります。

1. 「今すぐバックアップ」 ウィザードの 「**バックアップ アイテムの選択**」 ページで、「**ファイルとフォルダー**」 オプションが選択されていることを確認し、「**次へ**」 をクリックします。

1. 「**バックアップの保持期限**」 ページで、既定の設定を受け入れ、「**次へ**」 をクリックします。

1. 「**確認**」 ページで、「**バックアップ**」 をクリックします。

1. バックアップが完了したら、「**閉じる**」 をクリックし、Microsoft Azure Backup を閉じます。

1. Azure portal が表示されている Web ブラザー ウィンドウに切り替え、「**Recovery Services コンテナー**」 ブレードに戻り、「**保護されたアイテム**」 セクションで、「**バックアップ アイテム**」 をクリックします。

1. 「**az104-10-rsv1 - バックアップ アイテム**」 ブレードで、「**Azure Backup エージェント**」 をクリックします。

1. 「**バックアップ アイテム (Azure Backup エージェント)**」 ブレードで **az104-10-vm1.** の **C:\\** ドライブを参照するエントリがあることを確認します。

#### タスク 5: Azure Recovery Services エージェント (オプション) を使用してファイルの回復を実行する

このタスクでは、Azure Recovery Services エージェントを使用してファイルの復元を実行します。

1. **az104-10-vm1** へのリモート デスクトップ セッション内で、ファイル エクスプローラーを開き、**C:\Windows\System32\\drivers\etc\\** フォルダーに移動し、**ホスト** ファイルを削除します。

1. Microsoft Azure Backup を開き、「**操作**」 ウィンドウで 「**データの回復**」 をクリックします。これにより、「**データ回復ウィザード**」 が起動します。

1. 「**データ回復ウィザード**」 の 「**はじめに**」 ページで、「**このサーバー (az104-10-vm1.)**」 オプションが選択されていることを確認し、「**次へ**」 をクリックします。

1. 「**回復モードの選択**」 ページで、「**個々のファイルおよびフォルダー**」 オプションが選択されていることを確認し、「**次へ**」 をクリックします。

1. 「**ボリュームと日付の選択**」 ページの 「**ボリュームの選択**」 ドロップダウン リストで、「**C:\\**」 を選択し、使用可能なバックアップの既定の選択をそのまま使用し、「**マウント**」 をクリックします。

    >**注**: マウント操作が完了するまでお待ちください。これにはおよそ 2 分かかる場合があります。

1. 「**ファイルの参照と回復**」 ページで、回復ボリュームのドライブ文字をメモし、robocopy の使用に関するヒントを確認します。

1. 「**スタート**」 をクリックし、「**Windows システム**」 フォルダーを展開して、「**コマンド プロンプト**」 をクリックします。

1. コマンド プロンプトから、次のコマンドを実行して、復元する **hosts** ファイルを元の場所にコピーします (`「recovery_volume」` を、以前に指定した回復ボリュームのドライブ文字に置き換えます)。

   ```sh
   robocopy [recovery_volume]:\Windows\System32\drivers\etc C:\Windows\system32\drivers\etc hosts /r:1 /w:1
   ```

1. 「**データ回復ウィザード**」に戻り、「**ファイルの参照と回復**」 の上で 「**マウント解除**」 をクリックし、確認のメッセージが表示されたら 「**はい**」 をクリックします。

1. リモート デスクトップ セッションを終了します。

#### タスク 6: Azure 仮想マシンのスナップショット (オプション) を使用してファイルの回復を実行する

このタスクでは、Azure 仮想マシン レベルのスナップショット ベースのバックアップからファイルを復元します。

1. ラボ コンピューターで実行されているブラウザー ウィンドウに切り替え、Azure portal を表示します。

1. Azure portalで、「**仮想マシン**」 を検索して選択し、「**仮想マシン**」 ブレードで、「**az104-10-vm0**」 を選択します。

1. 「**az104-10-vm0**」 ブレードで、「**接続**」 をクリックし、ドロップダウン メニューで 「**RDP**」 をクリックし、「**RDP を使用して接続する**」 ブレードで 「**RDP ファイルのダウンロード**」 をクリックし、プロンプトに従ってリモート デスクトップ セッションを開始します。

    >**注**: この手順では、Windows コンピューターからリモート デスクトップ経由で接続することを指します。Mac では、Mac App Store からリモート デスクトップ クライアントを使用でき、Linux コンピューターでは、オープンソースの RDP クライアント ソフトウェアを使用できます。

    >**注**: ターゲット仮想マシンに接続する際は、警告メッセージを無視できます。

1. プロンプトが表示されたら、**Student**のユーザー名と **Pa55w.rd1234** パスワードを使用してサインインします。

   >**注:** Azure portal では IE 11 をさおーとしなくなっているため、このタスクには Microsoft Edge ブラウザーを利用する必要があります。

1. **az104-10-vm0** へのリモート デスクトップ セッションで、「**スタート**」 ボタンをクリックし、「**Windows システム**」 フォルダーを展開して、「**コマンド プロンプト**」 をクリックします。

1. コマンド プロンプトから、次の操作を実行して、**hosts** ファイルを削除します。

   ```sh
   del C:\Windows\system32\drivers\etc\hosts
   ```

   >**注**: このファイルは、このタスクの後半で、Azure 仮想マシン レベルのスナップショット ベースのバックアップから復元します。

1. **az104-10-vm0** Azure 仮想マシンへのリモート デスクトップ セッション内で、Edge Web ブラザーを起動し、[Azure portal](https://portal.azure.com) を参照して、資格情報を使用してサインインします。

1. Azure portal で、「**Recovery Services コンテナー**」 を検索して選択し、「**Recovery Services コンテナー**」 ブレードで、「**az104-10-rsv1**」 をクリックします。

1. 「**az104-10-rsv1** Recovery Services コンテナー」 ブレードの 「**保護されたアイテム**」 セクションで、「**バックアップ アイテム**」 をクリックします。

1. 「**az104-10-rsv1 - バックアップ アイテム**」 ブレードで、「**Azure 仮想マシン**」 をクリックします。

1. 「**バックアップ アイテム (Azure 仮想マシン)**」 ブレードで、「**az104-10-vm0**」 をクリックします。

1. 「**az104-10-vm0** バックアップ アイテム」 ブレードで、「**ファイルの回復**」 をクリックします。

    > **注**: アプリケーションの整合性スナップショットに基づいて、バックアップの開始直後にリカバリを実行するオプションがあります。

1. 「**ファイルの回復**」 ブレードで、既定の回復ポイントを受け入れ、「**実行可能ファイルのダウンロード**」 をクリックします。

    >**注**: スクリプトは、選択した復旧ポイントから、スクリプトの実行元のオペレーティング システム内のローカル ドライブとしてディスクをマウントします。

1. 「**ダウンロード**」 をクリックし、**IaaSVMILRExeForWindows.exe** を実行するか保存するかを尋ねられたら、「**保存**」 をクリックします。

1. 「エクスプローラー」 ウィンドウに戻り、新しくダウンロードしたファイルをダブルクリックします。

1. ポータルからパスワードを入力するように求められたら、「**ファイルの回復**」 ブレードの 「**スクリプトを実行するためのパスワード**」 テキスト ボックスからパスワードをコピーし、コマンド プロンプトに貼り付け、「**Enter**」 を押します。

    >**注**: これにより、マウントの進行状況を表示する Windows PowerShell ウィンドウが開きます。

    >**注**: この時点でエラー メッセージが表示された場合は、Web ブラザー ウィンドウを更新し、最後の 3 つの手順を繰り返します。

1. マウント処理が完了するのを待ち、Windows PowerShell ウィンドウで情報メッセージを確認し、**Windows** をホストしているボリュームに割り当てられているドライブ文字をメモし、エクスプローラーを起動します。

1. エクスプローラーで、前の手順で識別したオペレーティング システム ボリュームのスナップショットをホストするドライブ文字に移動し、その内容を確認します。

1. 「**コマンド プロンプト**」 ウィンドウに切り替えます。

1. コマンド プロンプトから、次のコマンドを実行して、復元する**ホスト**ファイルを元の場所にコピーします (`「os_volume」` を、以前に指定したオペレーティング システム ボリュームのドライブ文字に置き換えます)。

   ```sh
   robocopy [os_volume]:\Windows\System32\drivers\etc C:\Windows\system32\drivers\etc hosts /r:1 /w:1
   ```

1. Azure portal の 「**ファイルの回復**」 ブレードに戻り、「**ディスクのマウント解除**」 をクリックします。

1. リモート デスクトップ セッションを終了します。

#### タスク 7: Azure Recovery Services の論理的な削除機能を確認する

1. Azure portal のラボ コンピューターで、「**Recovery Services コンテナー**」 を検索して選択し、「**Recovery Services コンテナー**」 ブレードで、「**az104-10-rsv1**」 を選択します。

1. 「**az104-10-rsv1** Recovery Services コンテナー」 ブレードの 「**保護されたアイテム**」 セクションで、「**バックアップ アイテム**」 をクリックします。

1. 「**az104-10-rsv1 - バックアップ アイテム**」 ブレードで、「**Azure Backup エージェント**」 をクリックします。

1. 「**バックアップ アイテム (Azure Backup エージェント)**」 ブレードで、**az104-10-vm1** のバックアップを表すエントリをクリックします。

1. 「**C:\\ on az104-10-vm1**」 ブレードで、「**az104-10-vm1**」 リンクをクリックします。

1. **az104-10-vm1** 上。「保護されたサーバー」 ブレードで、「**削除**」 をクリックします。

1. 「**削除**」 ブレードで、次の設定を指定します。

    | 設定 | 値 |
    | --- | --- |
    | サーバー名を入力します | **az104-10-vm1.** |
    | 理由 | **Dev/Test サーバーのリサイクル** |
    | コメント | **az104 10 lab** |

    >**注**: サーバー名を入力するときに末尾のピリオドを含めます。

1. ラベル「**このサーバーに関連付けられている 1 つのバックアップ アイテムのバックアップ データがあります「確認」 をクリックすると、すべてのクラウド バックアップ データが完全に削除されることを理解しています。この操作は元に戻せません。このサブスクリプションの管理者に、この削除を通知するアラートが送信される場合があります**」の横にあるチェックボックスを有効にし、「**削除**」 をクリックします。

1. 「**az104-10-rsv1 - バックアップ アイテム**」 ブレードに戻り、「**Azure 仮想マシン**」 をクリックします。

1. 「**az104-10-rsv1 - バックアップ アイテム**」 ブレードで、「**Azure 仮想マシン**」 をクリックします。

1. 「**バックアップ アイテム (Azure 仮想マシン)**」 ブレードで、「**az104-10-vm0**」 をクリックします。

1. 「**az104-10-vm0 バックアップ アイテム**」 ブレードで、「**バックアップの停止**」 をクリックします。

1. 「**バックアップの停止**」 ブレードで、「**バックアップ データの削除**」 を選択し、次の設定を指定して 「**バックアップの停止**」 をクリックします。

    | 設定 | 値 |
    | --- | --- |
    | バックアップ アイテムの名前を入力してください | **az104-10-vm0** |
    | 理由 | **その他** |
    | コメント | **az104 10 lab** |

1. 「**az04-10-rsv1 - バックアップ アイテム**」 ブレードに戻り、「**更新**」 をクリックします。

    >**注**: **Azure 仮想マシン**のエントリは、まだ **1** つのバックアップ アイテムを一覧表示します。

1. 「**Azure 仮想マシン**」 エントリをクリックし、「**バックアップ アイテム (Azure 仮想マシン)**」 ブレードで 「**az104-10-vm0**」 エントリをクリックします。

1. 「**az104-10-vm0** バックアップ アイテム」 ブレードで、削除されたバックアップの**削除を取り消す**オプションがあることに注意してください。

    >**注**: この機能は、Azure 仮想マシンのバックアップが既定で有効になっている、論理的な削除機能によって提供されます。

1. 「**az104-10-rsv1** Recovery Services コンテナー」 ブレードに戻り、「**設定**」 セクションで、「**プロパティ**」 をクリックします。

1. 「**az104-10-rsv1 - プロパティ**」 ブレードで、「**セキュリティ設定**」 ラベルの下の 「**更新**」 リンクを選択します。

1. 「**セキュリティ設定**」 ブレードで、「**論理的な削除 (Azureで実行されているワークロードの場合)**」 を無効にし、「**保存**」 をクリックします。

    >**注**: これは、既にソフト削除状態のアイテムには影響しません。

1. 「**セキュリティ設定**」 ブレードを閉じ、「**az104-10-rsv1** Recovery Services コンテナー」 ブレードに戻り、「**概要**」 をクリックします。

1. 「**az104-10-vm0** バックアップ アイテム」 ブレードに戻り、「**削除の取り消し**」 をクリックします。

1. 「**az104-10-vm0 の削除を取り消す**」 ブレードで、「**削除の取り消し**」 をクリックします。

1. 削除取り消し操作が完了するのを待ち、必要に応じて Web ブラウザーのページを更新し、「**az104-10-vm0** バックアップ アイテム」 ブレードに戻り、「**バックアップ データの削除**」 をクリックします。

1. 「**バックアップ データの削除**」 ブレードで次の設定を指定し、「**削除**」 をクリックします。

    | 設定 | 値 |
    | --- | --- |
    | バックアップ アイテムの名前を入力してください | **az104-10-vm0** |
    | 理由 | **その他** |
    | コメント | **az104 10 lab** |

#### リソースをクリーン アップする

   >**注**: 新しく作成した Azure リソースのうち、使用しないリソースは必ず削除してください。使用しないリソースを削除しないと、予期しないコストが発生する場合があります。

1. Azure portal の 「**Cloud Shell**」 ウィンドウで 「**PowerShell**」 セッションを開きます。

1. 次のコマンドを実行して、このモジュールのラボ全体で作成したすべてのリソース グループのリストを表示します。

   ```powershell
   Get-AzResourceGroup -Name 'az104-10*'
   ```

1. 次のコマンドを実行して、このモジュールのラボ全体で作成したすべてのリソース グループのリストを削除します。

   ```powershell
   Get-AzResourceGroup -Name 'az104-10*' | Remove-AzResourceGroup -Force -AsJob
   ```

   >**注**: 必要に応じて、**AzureBackupRG_** のプレフィックスが付いた自動生成リソース グループを削除することを検討してください (その存在に関連する追加料金はありません)。

    >**注**: コマンドは非同期で実行されるので (-AsJob パラメーターによって決定されます)、別の PowerShell コマンドを同一 PowerShell セッション内ですぐに実行できますが、リソース グループが実際に削除されるまでに数分かかります。

#### レビュー

このラボでは次の内容を学習しました。

+ ラボ環境をプロビジョニングしました
+ Recovery Services コンテナーを作成しました
+ Azure 仮想マシン レベルのバックアップを実装しました
+ ファイルとフォルダーのバックアップを実装しました
+ Azure Recovery Services エージェントを使用したファイル回復を行いました
+ Azure 仮想マシンのスナップショットを使用したファイル回復を行いました
+ Azure Recovery Services のソフト削除機能を確認しました
