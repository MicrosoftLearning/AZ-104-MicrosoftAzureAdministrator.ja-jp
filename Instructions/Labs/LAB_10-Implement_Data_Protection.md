---
lab:
  title: 10 - データ保護を実装する
  module: Administer Data Protection
---

# <a name="lab-10---backup-virtual-machines"></a>ラボ 10 - 仮想マシンのバックアップ
# <a name="student-lab-manual"></a>受講生用ラボ マニュアル

## <a name="lab-scenario"></a>ラボのシナリオ

Azure 仮想マシンとオンプレミス コンピューターでホストされているファイルのバックアップと復元に Azure Recovery Services の使用を検討します。 また、Recovery Services コンテナーに格納されているデータを、不慮または悪意のあるデータ損失から保護する方法を確認したいと思っています。

                **メモ:** このラボをご自分のペースでクリックして進めることができる、 **[ラボの対話型シミュレーション](https://mslabs.cloudguides.com/guides/AZ-104%20Exam%20Guide%20-%20Microsoft%20Azure%20Administrator%20Exercise%2016)** が用意されています。 対話型シミュレーションとホストされたラボの間に若干の違いがある場合がありますが、示されている主要な概念とアイデアは同じです。 

## <a name="objectives"></a>目標

このラボでは、次のことを行います。

+ タスク 1:ラボ環境をプロビジョニングする
+ タスク 2:Recovery Services コンテナーを作成する
+ タスク 3:Azure 仮想マシン レベルのバックアップを実装する
+ タスク 4:ファイルとフォルダーのバックアップを実装する
+ タスク 5:Azure Recovery Services エージェントを使用してファイルの回復を行う
+ タスク 6:Azure 仮想マシンのスナップショット (オプション) を使用してファイルの回復を実行する
+ タスク 7:Azure Recovery Services の論理的な削除機能 (オプション) を確認する

## <a name="estimated-timing-50-minutes"></a>推定時間:50 分

## <a name="architecture-diagram"></a>アーキテクチャの図

![image](../media/lab10.png)

## <a name="instructions"></a>Instructions

### <a name="exercise-1"></a>演習 1

#### <a name="task-1-provision-the-lab-environment"></a>タスク 1:ラボ環境をプロビジョニングする

このタスクでは、異なるバックアップ シナリオをテストするために使用する 2 つの仮想マシンをデプロイします。

1. [Azure portal](https://portal.azure.com) にサインインします。

1. Azure portal の右上にあるアイコンをクリックして **Azure Cloud Shell** を開きます。

1. **Bash** または **PowerShell** の選択を求めるメッセージが表示されたら、 **[PowerShell]** を選択します。

    >**注**: **Cloud Shell** の初回起動時に "**ストレージがマウントされていません**" というメッセージが表示された場合は、このラボで使用しているサブスクリプションを選択し、**[ストレージの作成]** を選択します。

1. Cloud Shell ペインのツールバーで、 **[ファイルのアップロード/ダウンロード]** アイコンをクリックし、ドロップダウン メニューで **[アップロード]** をクリックして、ファイル **\\Allfiles\\Labs\\10\\az104-10-vms-edge-template.json** と **\\Allfiles\\Labs\\10\\az104-10-vms-edge-parameters.json** を Cloud Shell ホーム ディレクトリにアップロードします。

1. アップロードしたばかりのパラメーター ファイルを編集し、パスワードを変更します。 シェルでのファイルの編集に関してヘルプが必要な場合は、インストラクターに相談してください。 ベスト プラクティスとして、パスワードなどのシークレットは、キー コンテナーに安全に保存する必要があります。 

1. Cloud Shell ウィンドウから次のコマンドを実行して、仮想マシンをホストするリソース グループを作成します (`[Azure_region]` プレースホルダーを、Azure 仮想マシンをデプロイする Azure リージョンの名前に置き換えます)。 各コマンド ラインを個別に入力し、個別に実行します。

   ```powershell
   $location = '[Azure_region]'
    ```
    
   ```powershell
   $rgName = 'az104-10-rg0'
    ```
    
   ```powershell
   New-AzResourceGroup -Name $rgName -Location $location
   ```

1. [Cloud Shell] ウィンドウで、次のコマンドを実行して 1 番目の仮想ネットワークを作成し、アップロードしたテンプレートとパラメーター ファイルを使用して仮想マシンをデプロイします。

   ```powershell
   New-AzResourceGroupDeployment `
      -ResourceGroupName $rgName `
      -TemplateFile $HOME/az104-10-vms-edge-template.json `
      -TemplateParameterFile $HOME/az104-10-vms-edge-parameters.json `
      -AsJob
   ```

1. Cloud Shell を最小化します (ただし、閉じないでください)。

    >**注**: デプロイが完了するのを待たずに、次のタスクに進んでください。 デプロイには約 5 分かかります。

#### <a name="task-2-create-a-recovery-services-vault"></a>タスク 2:Recovery Services コンテナーを作成する

このタスクでは、Recovery Services コンテナーを作成します。

1. Azure portal で、「**Recovery Services コンテナー**」を検索して選択し、**[Recovery Services コンテナー]** ウィンドウで **[+ 作成]** をクリックします。

1. **[Recovery Services コンテナーの作成]** ウィンドウで、次の設定を指定します。

    | 設定 | 値 |
    | --- | --- |
    | サブスクリプション | このラボで使用している Azure サブスクリプションの名前 |
    | リソース グループ | 新しいリソース グループ **az104-10-rg1** の名前 |
    | コンテナー名 | **az104-10-rsv1** |
    | リージョン | 前のタスクで 2 つの仮想マシンをデプロイしたリージョンの名前 |

    >**注**: 前のタスクで仮想マシンをデプロイしたリージョンを必ず指定してください。

1. **[確認および作成]** をクリックし、検証が成功したことを確認して、**[作成]** をクリックします。

    >**注**:デプロイが完了するまで待ちます。 デプロイは 1 分以内に完了します。

1. デプロイが完了したら、**[リソースに移動]** をクリックします。

1. **az104-10-rsv1** の [Recovery Services コンテナー] ウィンドウの **[設定]** セクションで、**[プロパティ]** をクリックします。

1. **[az104-10-rsv1 - プロパティ]** ウィンドウで、**[バックアップ構成]** ラベルの下の **[更新]** リンクをクリックします。

1. **[バックアップ構成]** ウィンドウで、**[ストレージ レプリケーションの種類]** を **[ローカル冗長]** または **[geo 冗長]** のいずれかに設定できます。 既定の設定である **[geo 冗長]** のままにして、ウィンドウを閉じます。

    >**注**:この設定は、既存のバックアップ アイテムがない場合にのみ構成できます。

1. **[az104-10-rsv1 - プロパティ]** ウィンドウに戻り、**[セキュリティの設定]** ラベルの下にある **[更新]** リンクをクリックします。

1. **[セキュリティ設定]** ブレードで、 **[論理的な削除] (Azure 仮想マシンの場合)** が **[有効]** であることを確認します。

1. **[セキュリティの設定]** ウィンドウを閉じ、**az104-10-rsv1** の Recovery Services コンテナー ウィンドウに戻り、**[概要]** をクリックします。

#### <a name="task-3-implement-azure-virtual-machine-level-backup"></a>タスク 3:Azure 仮想マシン レベルのバックアップを実装する

このタスクでは、Azure 仮想マシン レベルのバックアップを実装します。

   >**注**:このタスクを開始する前に、このラボの最初のタスクで開始したデプロイが正常に完了したことを確認します。

1. **az104-10-rsv1** の [Recovery Services コンテナー] ウィンドウで、**[概要]** をクリックしてから、**[+ バックアップ]** をクリックします。

1. **[バックアップの目標]** ウィンドウで、次の設定を指定します。

    | 設定 | 値 |
    | --- | --- |
    | ワークロードはどこで実行されていますか? | **Azure** |
    | バックアップの対象。 | **仮想マシン** |

1. **[バックアップの目標]** ウィンドウで、**[バックアップ]** をクリックします。

1. **[バックアップ ポリシー]** で、**[DefaultPolicy]** の設定を確認し、**[新しいポリシーの作成]** を選択します。

1. 次の設定を使用して新しいバックアップ ポリシーを定義します (他の設定は既定値のままにします)。

    | 設定 | 値 |
    | ---- | ---- |
    | ポリシー名 | **az104-10-backup-policy** |
    | 頻度 | **毎日** |
    | Time | **12:00 AM** |
    | タイム ゾーン | ローカル タイム ゾーンの名前 |
    | のインスタント回復スナップショットを保持 | **2** 日間 |

1. **[OK]** をクリックしてポリシーを作成し、**[仮想マシン]** セクションで **[追加]** を選択します。

1. **[仮想マシンの選択]** ウィンドウで、**az-104-10-vm0** を選択し、**[OK]** をクリックして、**[バックアップ]** ウィンドウで、**[バックアップを有効にする]** をクリックします。

    >**注**:バックアップが有効になるまで待ちます。 これには 2 分ほどかかります。

1. **az104-10-rsv1** の [Recovery Services コンテナー] ブレードに戻り、 **[保護されたアイテム]** セクションで **[バックアップ アイテム]** をクリックしてから、 **[Azure 仮想マシン]** エントリをクリックします。

1. **[バックアップ アイテム (Azure 仮想マシン)]** ブレードで、**az104-10-vm0** の **[詳細の表示]** を選択し、 **[バックアップ事前チェック]** 、および **[最後のバックアップの状態]** エントリの値を確認します。

1. **az104-10-vm0** の [バックアップ項目] ウィンドウで、**[今すぐバックアップ]** をクリックし、**[バックアップの保持期限]** ドロップダウン リストで既定値をそのまま使用して、**[OK]** をクリックします。

    >**注**:バックアップが完了するのを待たずに、次のタスクに進みます。

#### <a name="task-4-implement-file-and-folder-backup"></a>タスク 4:ファイルとフォルダーのバックアップを実装する

このタスクでは、Azure Recovery Services を使用してファイルとフォルダーのバックアップを実装します。

1. Azure portal で、**[仮想マシン]** を検索して選択し、**[仮想マシン]** ウィンドウで、**az104-10-vm1** を選択します。

1. **az104-10-vm1** ブレードで、 **[接続]** をクリックし、ドロップダウン メニューで **[RDP]** をクリックし、 **[RDP を使用して接続する]** ブレードで **[RDP ファイルのダウンロード]** をクリックし、プロンプトに従ってリモート デスクトップ セッションを開始します。

    >**注**:この手順では、Windows コンピューターからリモート デスクトップ経由で接続することを指します。 Mac では、Mac App Store からリモート デスクトップ クライアントを使用でき、Linux コンピューターでは、オープンソースの RDP クライアント ソフトウェアを使用できます。

    >**注**:ターゲット仮想マシンに接続する際は、警告メッセージを無視できます。

1. メッセージが表示されたら、 **[学生]** のユーザー名とパラメーター ファイルのパスワードを使用してサインインします。

    >**注:**  Azure portal では IE 11 をサポートしなくなっているため、このタスクには Microsoft Edge ブラウザーを利用する必要があります。

1. **az104-10-vm1** Azure 仮想マシンへのリモート デスクトップ セッション内で、Edge Web ブラザーを起動し、[Azure portal](https://portal.azure.com) を参照して、資格情報を使用してサインインします。

1. Azure portal で、**[Recovery Services コンテナー]** を検索して選択し、**[Recovery Services コンテナー]** で、**az104-10-rsv1** をクリックします。

1. **az104-10-rsv1** の [Recovery Services コンテナー] ウィンドウで、**[+ バックアップ]** をクリックします。

1. **[バックアップの目標]** ウィンドウで、次の設定を指定します。

    | 設定 | 値 |
    | --- | --- |
    | ワークロードはどこで実行されていますか? | **オンプレミス** |
    | バックアップの対象。 | **ファイルとフォルダー** |

    >**注**:このタスクで使用している仮想マシンは Azure で実行されていますが、この仮想マシンを利用して、Windows Server オペレーティング システムを実行しているオンプレミス コンピューターに適用可能なバックアップ機能を評価できます。

1. **[バックアップの目標]** ウィンドウで、**[インフラストラクチャの準備]** をクリックします。

1. **[インフラストラクチャの準備]** ウィンドウドで、**[Windows Server または Windows クライアント用エージェントのダウンロード]** リンクをクリックします。

1. プロンプトが表示されたら、**[実行]** をクリックして、既定の設定で **MARSAgentInstaller.exe** のインストールを開始します。

    >**注**: **Microsoft Azure Recovery Services Agent セットアップ ウィザード**の **[Microsoft Update のオプトイン]** ページで、**[Microsoft Update を使用しない]** インストール オプションを選択します。

1. **Microsoft Azure Recovery Services Agent セットアップ ウィザード**の **[インストール]** ページで、**[登録処理を続行]** をクリックします。 これにより、**サーバーの登録ウィザード**が起動します。

1. Azure portal を表示している Web ブラザー ウィンドウに切り替え、**[インフラストラクチャの準備]** ウィンドウで、**[最新の Recovery Server Agent を既にダウンロードしたか、使用している]** チェックボックスをオンにして、**[ダウンロード]** をクリックします。

1. コンテナーの資格情報ファイルを開くか保存するかを確認するメッセージが表示されたら、**[保存]** をクリックします。 これにより、コンテナーの資格情報ファイルがローカルの [ダウンロード] フォルダーに保存されます。

1. **[サーバーの登録ウィザード]** ウィンドウに戻り、**[コンテナー ID]** ページで、**[参照]** をクリックします。

1. **[資格情報コンテナーの資格情報の選択]** ダイアログ ボックスで、**[ダウンロード]** フォルダーを参照し、ダウンロードしたコンテナー資格情報ファイルをクリックして、**[開く]** をクリックします。

1. **[コンテナー ID]** ページに戻り、**[次へ]** をクリックします。

1. **[サーバー登録ウィザード]** の **[暗号化の設定]** ページで、**[パスフレーズの生成]** をクリックします。

1. **[サーバーの登録ウィザード]** の **[暗号化設定]** ページで、 **[パスフレーズを保存する場所を入力してください]** ドロップダウン リストの横にある、 **[参照]** ボタンをクリックします。

1. **[フォルダーの参照]** ダイアログ ボックスで、**[ドキュメント]** フォルダーを選択し、**[OK]** をクリックします。

1. **[完了]** をクリックし、**Microsoft Azure Backup** の警告を確認して **[はい]** をクリックし、登録が完了するまで待ちます。

    >**注**:運用環境では、バックアップするサーバー以外の安全な場所にパスフレーズ ファイルを保存する必要があります。

1. **サーバーの登録ウィザード**の **[サーバーの登録]** ページで、パスフレーズ ファイルの場所に関する警告を確認し、**[Microsoft Azure Recovery Services Agent の起動]** チェックボックスがオンになっていることを確認して、**[閉じる]** をクリックします。 これにより、**Microsoft Azure Backup** コンソールが自動的に開きます。

1. **Microsoft Azure Backup** コンソールの **[操作]** ペインで、**[バックアップのスケジュール]** をクリックします。

1. **バックアップのスケジュール ウィザード**の **[はじめに]** ページで、**[次へ]** をクリックします。

1. **[バックアップする項目の選択]** ページで、 **[項目の追加]** をクリックします。

1. **[アイテムの選択]** ダイアログ ボックスで、**C:\\Windows\\System32\\drivers\\etc\\** を展開し、**hosts** を選択して **[OK]** をクリックします。

1. **[バックアップする項目の選択]** ページで、**[次へ]** をクリックします。

1. **[バックアップする項目の選択]** ページで、**[日]** オプションが選択されていることを確認し、**[時刻を指定 (最大で 1 日に 3 回)]** ボックスの下にある最初のドロップダウン リスト ボックスで **[4:30 AM]** を選択して、**[次へ]** をクリックします。

1. **[保持ポリシーの選択]** ページで、既定値をそのまま使用し、**[次へ]** をクリックします。

1. **[初期バックアップの種類の選択]** ページで、既定値をそのまま使用し、**[次へ]** をクリックします。

1. **[確認]** ページで、**[完了]** をクリックします。 バックアップ スケジュールが作成されたら、**[閉じる]** をクリックします。

1. **Microsoft Azure Backup** コンソールの [操作] ペインで、**[今すぐバックアップ]** をクリックします。

    >**注**:スケジュール バックアップを作成すると、オンデマンドでバックアップを実行するオプションが使用可能になります。

1. 今すぐバックアップ ウィザードの **[バックアップ項目の選択]** ページで、**[ファイルとフォルダー]** オプションが選択されていることを確認して、**[次へ]** をクリックします。

1. **[バックアップの保持期限]** ページで、既定の設定をそのまま使用し、**[次へ]** をクリックします。

1. **[確認]** ページで、**[バックアップ]** をクリックします。

1. バックアップが完了したら、**[閉じる]** をクリックしてから、Microsoft Azure Backup を閉じます。

1. Azure portal が表示されている Web ブラザー ウィンドウに切り替え、**[Recovery Services コンテナー]** ウィンドウに戻り、**[保護されたアイテム]** セクションで、**[バックアップ アイテム]** をクリックします。

1. **[az104-10-rsv1 - バックアップ アイテム]** ウィンドウで、**[Azure Backup エージェント]** をクリックします。

1. **[バックアップ アイテム (Azure Backup エージェント)]** ブレードで **az104-10-vm1** の **C:\\** ドライブを参照するエントリがあることを確認します。

#### <a name="task-5-perform-file-recovery-by-using-azure-recovery-services-agent-optional"></a>タスク 5:Azure Recovery Services エージェント (オプション) を使用してファイルの回復を実行する

このタスクでは、Azure Recovery Services エージェントを使用してファイルの復元を実行します。

1. **az104-10-vm1** へのリモート デスクトップ セッション内で、ファイル エクスプローラーを開き、**C:\\Windows\\System32\\drivers\\etc\\** フォルダーに移動し、**hosts** ファイルを削除します。

1. Microsoft Azure Backup を開き、**[操作]** ペインで **[データの回復]** をクリックします。 これにより、**データ回復ウィザード**が開始します。

1. **データ回復ウィザード**の **[はじめに]** ページで、**[このサーバー (az104-10-vm1.)]** オプションが選択されていることを確認して、**[次へ]** をクリックします。

1. **[回復モードの選択]** ページで、**[個々のファイルおよびフォルダー]** オプションが選択されていることを確認し、**[次へ]** をクリックします。

1. **[ボリュームと日付の選択]** ページの **[ボリュームの選択]** ドロップダウン リストで、**C:\\** を選択し、使用可能なバックアップの既定の選択をそのまま使用し、 **[マウント]** をクリックします。

    >**注**:マウント操作が完了するまでお待ちください。 これには 2 分ほどかかる場合があります。

1. **[File の参照と回復]** ページで、回復ボリュームのドライブ文字を記録し、robocopy の使用に関するヒントを確認します。

1. **[スタート]** をクリックし、**[Windows システム]** フォルダーを展開して、**[コマンド プロンプト]** をクリックします。

1. コマンド プロンプトから、次のコマンドを実行して、復元する **hosts** ファイルを元の場所にコピーします (`[recovery_volume]` を、以前に指定した回復ボリュームのドライブ文字に置き換えます)。

   ```sh
   robocopy [recovery_volume]:\Windows\System32\drivers\etc C:\Windows\system32\drivers\etc hosts /r:1 /w:1
   ```

1. **データ回復ウィザード**に戻り、**[File の参照と回復]** で **[マウント解除]** をクリックし、確認のメッセージが表示されたら **[はい]** をクリックします。

1. リモート デスクトップ セッションを終了します。

#### <a name="task-6-perform-file-recovery-by-using-azure-virtual-machine-snapshots-optional"></a>タスク 6:Azure 仮想マシンのスナップショット (オプション) を使用してファイルの回復を実行する

このタスクでは、Azure 仮想マシン レベルのスナップショット ベースのバックアップからファイルを復元します。

1. ラボ コンピューターで実行されているブラウザー ウィンドウに切り替え、Azure portal を表示します。

1. Azure portal で、「**仮想マシン**」を検索して選択し、**[仮想マシン]** ウィンドウで **az104-10-vm0** をクリックします。

1. **[az104-10-vm0]** ブレードで、 **[接続]** をクリックし、ドロップダウン メニューで **[RDP]** をクリックし、 **[RDP を使用して接続する]** ブレードで **[RDP ファイルのダウンロード]** をクリックし、プロンプトに従ってリモート デスクトップ セッションを開始します。

    >**注**:この手順では、Windows コンピューターからリモート デスクトップ経由で接続することを指します。 Mac では、Mac App Store からリモート デスクトップ クライアントを使用でき、Linux コンピューターでは、オープンソースの RDP クライアント ソフトウェアを使用できます。

    >**注**:ターゲット仮想マシンに接続する際は、警告メッセージを無視できます。

1. メッセージが表示されたら、 **[学生]** のユーザー名とパラメーター ファイルのパスワードを使用してサインインします。

   >**注:**  Azure portal では IE 11 をサポートしなくなっているため、このタスクには Microsoft Edge ブラウザーを利用する必要があります。

1. **az104-10-vm0** へのリモート デスクトップ セッションで、**[スタート]** ボタンをクリックし、**[Windows システム]** フォルダーを展開して、**[コマンド プロンプト]** をクリックします。

1. コマンド プロンプトから、次の操作を実行して、**hosts** ファイルを削除します。

   ```sh
   del C:\Windows\system32\drivers\etc\hosts
   ```

   >**注**:このファイルは、このタスクの後半で、Azure 仮想マシン レベルのスナップショット ベースのバックアップから復元します。

1. **az104-10-vm0** Azure 仮想マシンへのリモート デスクトップ セッション内で、Edge Web ブラザーを起動し、[Azure portal](https://portal.azure.com) を参照して、資格情報を使用してサインインします。

1. Azure portal で、**[Recovery Services コンテナー]** を検索して選択し、**[Recovery Services コンテナー]** で、**az104-10-rsv1** をクリックします。

1. **az104-10-rsv1** の [Recovery Services コンテナー」 ウィンドウの **[保護されたアイテム]** セクションで、**[バックアップ アイテム]** をクリックします。

1. **[az104-10-rsv1 - バックアップ アイテム]** ウィンドウで、**[Azure 仮想マシン]** をクリックします。

1. **[バックアップ項目 (Azure 仮想マシン)]** ブレードで、**az104-10-vm0** の **[詳細の表示]** を選択します。

1. **az104-10-vm0** の [バックアップ アイテム] ウィンドウで、**[ファイルの回復]** をクリックします。

    >**注**:アプリケーションの整合性スナップショットに基づいて、バックアップの開始直後にリカバリを実行するオプションがあります。

1. **[ファイルの回復]** ウィンドウで、既定の回復ポイントをそのまま使用し、**[実行可能ファイルのダウンロード]** をクリックします。

    >**注**:スクリプトは、選択した復旧ポイントから、スクリプトの実行元のオペレーティング システム内のローカル ドライブとしてディスクをマウントします。

1. **[ダウンロード]** をクリックし、**IaaSVMILRExeForWindows.exe** を実行するか保存するかを尋ねられたら、**[保存]** をクリックします。

1. [エクスプローラー] ウィンドウに戻り、新しくダウンロードしたファイルをダブルクリックします。

1. ポータルからパスワードを入力するように求められたら、**[ファイルの回復]** ウィンドウの **[スクリプトを実行するためのパスワード]** テキスト ボックスからパスワードをコピーし、コマンド プロンプトに貼り付けて、**Enter** キーを押します。

    >**注**:これにより、マウントの進行状況を表示する Windows PowerShell ウィンドウが開きます。

    >**注**:この時点でエラー メッセージが表示された場合は、Web ブラザー ウィンドウを更新し、最後の 3 つの手順を繰り返します。

1. マウント処理が完了するのを待ち、Windows PowerShell ウィンドウで情報メッセージを確認し、**Windows** をホストしているボリュームに割り当てられているドライブ文字をメモし、エクスプローラーを起動します。

1. エクスプローラーで、前の手順で識別したオペレーティング システム ボリュームのスナップショットをホストするドライブ文字に移動し、その内容を確認します。

1. **コマンド プロンプト** ウィンドウに切り替えます。

1. コマンド プロンプトから、次のコマンドを実行して、復元する **hosts** ファイルを元の場所にコピーします (`[os_volume]` を、以前に指定したオペレーティング システム ボリュームのドライブ文字に置き換えます)。

   ```sh
   robocopy [os_volume]:\Windows\System32\drivers\etc C:\Windows\system32\drivers\etc hosts /r:1 /w:1
   ```

1. Azure portal の **[ファイルの回復]** ウィンドウに戻り、**[ディスクのマウント解除]** をクリックします。

1. リモート デスクトップ セッションを終了します。

#### <a name="task-7-review-the-azure-recovery-services-soft-delete-functionality"></a>タスク 7:Azure Recovery Services の論理的な削除機能を確認する

1. ラボ コンピューターの Azure portal で、「**Recovery Services コンテナー**」を検索して選択し、**[Recovery Services コンテナー]** ウィンドウで、**az104-10-rsv1** を選択します。

1. **az104-10-rsv1** の [Recovery Services コンテナー」 ウィンドウの **[保護されたアイテム]** セクションで、**[バックアップ アイテム]** をクリックします。

1. **[az104-10-rsv1 - バックアップ アイテム]** ウィンドウで、**[Azure Backup エージェント]** をクリックします。

1. **[バックアップ アイテム (Azure Backup エージェント)]** ウィンドウで、**az104-10-vm1** のバックアップを表すエントリをクリックします。

1. **C:\\ 上の az104-10-vm1** ブレードで、**az104-10-vm1** の **[詳細の表示]** を選択します。 .

1. [詳細] ウィンドウで、**az104-10-vm1** をクリックします。

1. **az104-10-vm1** 上。 [保護されたサーバー] ウィンドウで、**[削除]** をクリックします。

1. **[削除]** ウィンドウで、次の設定を指定します。

    | 設定 | 値 |
    | --- | --- |
    | サーバー名を入力します | **az104-10-vm1** |
    | 理由 | **Dev/Test サーバーのリサイクル** |
    | 説明 | **az104 10 ラボ** |

    >**注**:サーバー名を入力するときに末尾のピリオドを含めます。

1. ラベル **[1 個のバックアップ項目から成るバックアップ データがこのサーバーに関連付けられています。[確認] をクリックすると、すべてのクラウド バックアップ データが完全に削除されることを理解しました。この操作を元に戻すことはできません。この削除を通知するアラートがこのサブスクリプションの管理者に送信されることがあります。]** の横にあるチェックボックスを有効にし、**[削除]** をクリックします。

    >**注**:**論理的な削除**機能を無効にする必要があるため、これは失敗します。

1. **[az104-10-rsv1 - バックアップ アイテム]** ブレードに戻り、**[Azure 仮想マシン]** をクリックします。

1. **[az104-10-rsv1 - バックアップ アイテム]** ウィンドウで、**[Azure 仮想マシン]** をクリックします。

1. **[バックアップ項目 (Azure 仮想マシン)]** ブレードで、**az104-10-vm0** の **[詳細の表示]** を選択します。

1. **az104-10-vm0** の [バックアップ アイテム」 ウィンドウで、**[バックアップの停止]** をクリックします。

1. **[バックアップの停止]** ウィンドウで、**[バックアップ データの削除]** を選択し、次の設定を指定して **[バックアップの停止]** をクリックします。

    | 設定 | 値 |
    | --- | --- |
    | バックアップ アイテムの名前を入力してください | **az104-10-vm0** |
    | 理由 | **Others** |
    | 説明 | **az104 10 ラボ** |

1. **[az104-10-rsv1 - バックアップ アイテム]** ウィンドウに戻り、**[更新]** をクリックします。

    >**注**:**Azure 仮想マシン**のエントリは、まだ **1** つのバックアップ アイテムを一覧表示します。

1. **[Azure 仮想マシン]** エントリをクリックし、**[バックアップ アイテム (Azure 仮想マシン)]** ウィンドウで **az104-10-vm0** エントリをクリックします。

1. **az104-10-vm0** の [バックアップ アイテム」 ブレードで、削除されたバックアップの**削除を取り消す**オプションがあることに注意してください。

    >**注**:この機能は、Azure 仮想マシンのバックアップが既定で有効になっている、論理的な削除機能によって提供されます。

1. **az104-10-rsv1** の [Recovery Services コンテナー] ウィンドウに戻り、**[設定]** セクションで **[プロパティ]** をクリックします。

1. **[az104-10-rsv1 - プロパティ]** ウィンドウで、**[セキュリティ設定]** ラベルの下の **[更新]** リンクをクリックします。

1. **[セキュリティ設定]** ブレードで、 **[論理的な削除 (Azure で実行されているワークロードの場合)]** を無効にし、 **[セキュリティ機能 (オンプレミスで実行されているワークロードの場合)]** も無効にして、 **[保存]** をクリックします。

    >**注**:これは、既にソフト削除状態のアイテムには影響しません。

1. **[セキュリティの設定]** ウィンドウを閉じ、**az104-10-rsv1** の Recovery Services コンテナー ウィンドウに戻り、**[概要]** をクリックします。

1. **az104-10-vm0** の [バックアップ アイテム」 ブレードに戻り、**[削除の取り消し]** をクリックします。

1. **[az104-10-vm0 の削除の取り消し]** ウィンドウで、**[削除の取り消し]** をクリックします。

1. 削除の取り消し操作が完了するのを待ち、必要に応じて Web ブラウザーのページを更新し、**az104-10-vm0** の [バックアップ アイテム] ブレードに戻り、**[バックアップ データの削除]** をクリックします。

1. **[バックアップ データの削除]** ウィンドウで次の設定を指定し、**[削除]** をクリックします。

    | 設定 | 値 |
    | --- | --- |
    | バックアップ アイテムの名前を入力してください | **az104-10-vm0** |
    | 理由 | **Others** |
    | 説明 | **az104 10 ラボ** |

1. このタスクの最初の手順を繰り返して、**az104-10-vm1** のバックアップ項目を削除します。

#### <a name="clean-up-resources"></a>リソースをクリーンアップする

>**注**:新規に作成し、使用しなくなったすべての Azure リソースを削除することを忘れないでください。 使用していないリソースを削除することで、予期しない料金が発生しなくなります。

>**注**:ラボのリソースをすぐに削除できなくても心配する必要はありません。 リソースに依存関係が存在し、削除に時間がかかる場合があります。 リソースの使用状況を監視することは管理者の一般的なタスクであるため、ポータルでリソースを定期的にチェックして、クリーンアップの進捗を確認するようにしてください。 

1. Azure portal で、**[Cloud Shell]** ペイン内に **PowerShell** セッションを開きます。

1. 次のコマンドを実行して、このモジュールのラボ全体で作成したすべてのリソース グループのリストを表示します。

   ```powershell
   Get-AzResourceGroup -Name 'az104-10*'
   ```

1. 次のコマンドを実行して、このモジュールのラボ全体を通して作成したすべてのリソース グループを削除します。

   ```powershell
   Get-AzResourceGroup -Name 'az104-10*' | Remove-AzResourceGroup -Force -AsJob
   ```

   >**注**:必要に応じて、**AzureBackupRG_** のプレフィックスが付いた自動生成リソース グループを削除することを検討してください (その存在に関連する追加料金はありません)。

    >**注**:このコマンドは非同期で実行されるため (-AsJob パラメーターによって決定されます)、同じ PowerShell セッション内で直後に別の PowerShell コマンドを実行できますが、リソース グループが実際に削除されるまでに数分かかります。

#### <a name="review"></a>確認

このラボでは、次のことを行いました。

+ ラボ環境をプロビジョニングしました
+ Recovery Services コンテナーを作成しました
+ Azure 仮想マシンレベルのバックアップを実装しました
+ ファイルとフォルダーのバックアップを実装しました
+ Azure Recovery Services エージェントを使用したファイル回復を行いました
+ Azure 仮想マシンのスナップショットを使用したファイル回復を行いました
+ Azure Recovery Services のソフト削除機能を確認しました
